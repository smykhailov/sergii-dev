{"componentChunkName":"component---src-components-article-tsx-content-file-path-home-runner-work-sergii-dev-sergii-dev-articles-2024-02-11-the-businessman-market-logic-mdx","path":"/articles/the-businessman-market-logic/","result":{"data":{"site":{"siteMetadata":{"title":"Sergii Mykhailov","author":"Sergii Mykhailov"}},"mdx":{"excerpt":"After we implemented the exchange logic, the Market logic becomes so easy, that we just need to copy/paste and rename some variables. UIâ€¦","body":"\nAfter we implemented the [exchange logic](/articles/the-businessman-exchange-logic), the **Market** logic becomes so easy, that we just need to copy/paste and rename some variables.\n\n## UI changes\n\nWe just add the input fields and error messge.\n\n```html {numberLines: 253}\n<div id=\"buy-car\" class=\"hidden text-smaller text-color-turquoise\">\n  <div>\n    <label for=\"car-num-to-buy\">\n      Which car do you want to buy (1-7):\n      <input\n        id=\"car-num-to-buy\"\n        title=\"Car number to buy\"\n        type=\"number\"\n        min=\"1\"\n        max=\"7\"\n        class=\"text-color-turquoise\"\n      />\n    </label>\n  </div>\n</div>\n<div id=\"buy-house\" class=\"hidden text-smaller text-color-turquoise\">\n  <div>\n    <label for=\"house-num-to-buy\">\n      Which house do you want to buy (1-7):\n      <input\n        id=\"house-num-to-buy\"\n        title=\"House number to buy\"\n        type=\"number\"\n        min=\"1\"\n        max=\"7\"\n        class=\"text-color-turquoise\"\n      />\n    </label>\n  </div>\n</div>\n<p id=\"market-error\" class=\"text-smaller text-color-red\"></p>\n```\n\n## Handling market buying logic\n\nThe logic to buy goods is similar to the one which we used in the exchange logic.\nBased on \"c\" or \"h\" key press, we will show the prompt to buy new car or house.\nAnd on \"Enter\" or \"Tab\" key press, we will process the purchase.\n\n{/* prettier-ignore-start */}\n```js {numberLines: 536, diff}\nconst assignMarketWindowActions = () => {\n  let buyCarProcessing = false;\n  let buyHouseProcessing = false;\n\n  document.addEventListener(\n    \"keydown\",\n    e => {\n      const marketWindow = document.getElementById(\"market-main\");\n      if (marketWindow.classList.contains(\"hidden\")) {\n        return;\n      }\n\n      const buyCarKeyBinding = \"c\";\n      const buyHouseKeyBinding = \"h\";\n\n      const marketError = document.getElementById(\"market-error\");\n      const buyCar = document.getElementById(\"buy-car\");\n      const buyHouse = document.getElementById(\"buy-house\");\n\n      const carNumToBuy = document.getElementById(\"car-num-to-buy\");\n      const houseNumToBuy = document.getElementById(\"house-num-to-buy\");\n\n      marketError.innerText = \"\";\n\n      const cleanPrompts = () => {\n        buyCar.classList.add(\"hidden\");\n        buyHouse.classList.add(\"hidden\");\n\n        carNumToBuy.value = \"\";\n        houseNumToBuy.value = \"\";\n\n        marketError.innerText = \"\";\n\n        buyCarProcessing = false;\n        buyHouseProcessing = false;\n      };\n\n      if (\n        e.key === buyCarKeyBinding ||\n        (e.key === buyCarKeyBinding.toUpperCase() && e.shiftKey)\n      ) {\n        if (buyHouseProcessing) {\n          return;\n        }\n\n        buyCar.classList.remove(\"hidden\");\n        carNumToBuy.focus();\n\n        buyCarProcessing = true;\n      }\n\n      if (\n        e.key === buyHouseKeyBinding ||\n        (e.key === buyHouseKeyBinding.toUpperCase() && e.shiftKey)\n      ) {\n        if (buyCarProcessing) {\n          return;\n        }\n\n        buyHouse.classList.remove(\"hidden\");\n        houseNumToBuy.focus();\n\n        buyHouseProcessing = true;\n      }\n\n      if (e.key === \"Enter\" || e.key === \"Tab\") {\n        if (buyCarProcessing) {\n          const num = +carNumToBuy.value;\n          const price = gameData.availableCars[num - 1].price;\n\n          if (price > gameData.accountBalances.accountBalance) {\n            carNumToBuy.value = \"\";\n            marketError.innerText = \"You do not have enough money.\";\n            return;\n          }\n\n          if (num > 0) {\n            gameData.assets.car = gameData.availableCars[num - 1];\n            gameData.accountBalances.accountBalance -= price;\n          } else {\n            return;\n          }\n        }\n\n        if (buyHouseProcessing) {\n          const num = +houseNumToBuy.value;\n          const price = gameData.availableHouses[num - 1].price;\n\n          if (price > gameData.accountBalances.accountBalance) {\n            houseNumToBuy.value = \"\";\n            marketError.innerText = \"You do not have enough money.\";\n            return;\n          }\n\n          if (num > 0) {\n            gameData.assets.house = gameData.availableHouses[num - 1];\n            gameData.accountBalances.accountBalance -= price;\n          } else {\n            return;\n          }\n        }\n\n        setAccountsBalance(gameData.accountBalances);\n\n        cleanPrompts();\n        document.getElementById(\"market-main\").classList.add(\"hidden\");\n      }\n\n      if (e.key === \"Escape\") {\n        cleanPrompts();\n      }\n    },\n    true\n  );\n};\n\nconst assignActionHandlers = () => { // L748\n  assignBankWindowActions();\n+   assignMarketWindowActions();\n  assignExchangeWindowActions();\n};\n```\n{/* prettier-ignore-end */}\n\n## Summary\n\nThe sources of the changes you can find on [GiHub](https://github.com/smykhailov/the-businessman/releases/tag/v0.14).\n\nIn the next article, we will implement the logic for the [**Assets**](/articles/the-businessman-assets-logic).\n","frontmatter":{"title":"The Businessman - Market Logic","date":"2024-02-11T19:12:51.000Z","tags":["businessman","project","javascript"],"keywords":["business logic","javascript","the game","github compare","market logic","market","buy car","buy house"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#0808f8","images":{"fallback":{"src":"/static/b59119518cef47236ef1eae0476683f1/65210/cover.png","srcSet":"/static/b59119518cef47236ef1eae0476683f1/1154e/cover.png 150w,\n/static/b59119518cef47236ef1eae0476683f1/7d4d5/cover.png 300w,\n/static/b59119518cef47236ef1eae0476683f1/65210/cover.png 600w","sizes":"(min-width: 600px) 600px, 100vw"},"sources":[{"srcSet":"/static/b59119518cef47236ef1eae0476683f1/49f80/cover.webp 150w,\n/static/b59119518cef47236ef1eae0476683f1/de298/cover.webp 300w,\n/static/b59119518cef47236ef1eae0476683f1/e5496/cover.webp 600w","type":"image/webp","sizes":"(min-width: 600px) 600px, 100vw"}]},"width":600,"height":329}}}},"internal":{"contentFilePath":"/home/runner/work/sergii-dev/sergii-dev/articles/2024-02-11-the-businessman-market-logic.mdx"},"fields":{"slug":"/articles/the-businessman-market-logic/","readingTime":{"text":"3 min read","minutes":2.285,"time":137100}}}},"pageContext":{"id":"060527b3-ff36-5f57-93aa-b998b69671d6","frontmatter":{"title":"The Businessman - Market Logic","date":"2024-02-11T19:12:51.000Z","published":true,"featuredImage":"./images/2024-02-11-the-businessman-market-logic/cover.png","categories":["Businessman"],"tags":["businessman","project","javascript"],"keywords":["business logic","javascript","the game","github compare","market logic","market","buy car","buy house"]}}},"staticQueryHashes":["1739528850","3446427935"],"slicesMap":{}}